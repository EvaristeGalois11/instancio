<!-- Elements added to main will be displayed on all pages -->

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://www.instancio.org/articles/creating-object-templates-using-models/">
      
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.3">
    
    
      
        <title>Creating object templates using Models - Instancio</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6b71719e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MYZQVSS3LL"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MYZQVSS3LL');
</script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
<meta name="description" content="Instancio is a library for instantiating and populating objects with random data. Its goal is to reduce the time and lines of code spent on manual data setup in unit tests.">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="deep-orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-object-templates-using-models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Instancio" class="md-header__button md-logo" aria-label="Instancio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Instancio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Creating object templates using Models
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/instancio/instancio" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    instancio
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../getting-started/" class="md-tabs__link">
      Getting Started
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../user-guide/" class="md-tabs__link">
      User Guide
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../building/" class="md-tabs__link">
      Building
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../" class="md-tabs__link">
      Articles
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Instancio" class="md-nav__button md-logo" aria-label="Instancio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Instancio
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/instancio/instancio" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    instancio
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/" class="md-nav__link">
        User Guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../building/" class="md-nav__link">
        Building
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Articles
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="creating-object-templates-using-models">Creating object templates using Models<a class="headerlink" href="#creating-object-templates-using-models" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>One of the challenges of setting up data for different test cases is creating objects in different states.
Test classes will often have helper methods with arguments for creating objects.
Even worse, common setup code will sometimes be duplicated across test methods.
Manual data setup can get quite complicated as classes get bigger and more complex.
This is especially true for classes with many relationships.
In this article, we will show how Models can be used to solve these challenges.</p>
<div class="admonition note">
<p class="admonition-title">GitHub link to the sample project is provided at the end of the article.</p>
</div>
<h2 id="testing-background">Testing background<a class="headerlink" href="#testing-background" title="Permanent link">&para;</a></h2>
<p>We will be testing a service that converts a college <code>Applicant</code> to an Avro class <code>ApplicantAvro</code>.
The <code>Applicant</code> class is provided below.
The <code>ApplicantAvro</code> class is auto-generated using an Avro schema, but essentially it has the same structure.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">class</span> <span class="nc">Applicant</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">firstName</span><span class="p">;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">middleName</span><span class="p">;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="n">Grade</span><span class="w"> </span><span class="n">grade</span><span class="p">;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">}</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="kd">enum</span><span class="w"> </span><span class="n">Grade</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="kd">class</span> <span class="nc">Address</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">street</span><span class="p">;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">city</span><span class="p">;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">country</span><span class="p">;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">postalCode</span><span class="p">;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="p">}</span>
</code></pre></div>
<p>Our conversion service <code>ApplicantToAvroMapper</code> requires that an applicant is 18-25 years old and has achieved grade A or B.
If those conditions are met, it constructs an Avro object and returns an <code>Optional</code> containing the result.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicantToAvroMapper</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">ApplicantAvro</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">toAvro</span><span class="p">(</span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">        </span><span class="n">Validate</span><span class="p">.</span><span class="na">isTrue</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">applicant</span><span class="p">.</span><span class="na">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">                </span><span class="s">&quot;Applicant must be between 18 and 25 years of age&quot;</span><span class="p">);</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">        </span><span class="n">Validate</span><span class="p">.</span><span class="na">isTrue</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getGrade</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">A</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">applicant</span><span class="p">.</span><span class="na">getGrade</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">B</span><span class="p">,</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">                </span><span class="s">&quot;Applicant&#39;s grade must be either A or B&quot;</span><span class="p">);</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">            </span><span class="n">ApplicantAvro</span><span class="w"> </span><span class="n">applicantAvro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ApplicantAvro</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">                    </span><span class="p">.</span><span class="na">setFirstName</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getFirstName</span><span class="p">())</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">                    </span><span class="p">.</span><span class="na">setMiddleName</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getMiddleName</span><span class="p">())</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">                    </span><span class="p">.</span><span class="na">setLastName</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getLastName</span><span class="p">())</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">                    </span><span class="p">.</span><span class="na">setAddress</span><span class="p">(</span><span class="n">addressToAvro</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()))</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">applicantAvro</span><span class="p">);</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">AvroRuntimeException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// log</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;Error converting applicant id=%d to Avro. Cause: &#39;%s&#39;%n&quot;</span><span class="p">,</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">                </span><span class="n">applicant</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">AddressAvro</span><span class="w"> </span><span class="nf">addressToAvro</span><span class="p">(</span><span class="n">Address</span><span class="w"> </span><span class="n">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AddressAvro</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">                </span><span class="p">.</span><span class="na">setStreet</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getStreet</span><span class="p">())</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">                </span><span class="p">.</span><span class="na">setCity</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getCity</span><span class="p">())</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">                </span><span class="p">.</span><span class="na">setPostalCode</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getPostalCode</span><span class="p">())</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">                </span><span class="p">.</span><span class="na">setCountry</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getCountry</span><span class="p">())</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>In addition, the Avro schema requires all the fields to be non-null except <code>middleName</code> and <code>postalCode</code>.
If a required field is <code>null</code>, the Avro builder will throw an <code>AvroRuntimeException</code>.
When that happens, we log the error and return an empty <code>Optional</code>.</p>
<h2 id="test-cases">Test cases<a class="headerlink" href="#test-cases" title="Permanent link">&para;</a></h2>
<p>Good tests should cover all branches of conditional logic.
This gives us greater confidence in our code and oftentimes uncovers issues we may have overlooked.
Although our service is very simple, it still presents a few scenarios that need to be covered.</p>
<table>
<thead>
<tr>
<th>Test case</th>
<th>Expectation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Successful conversion</td>
<td>An <code>Optional</code> containing <code>ApplicantAvro</code></td>
</tr>
<tr>
<td>Applicant is under 18</td>
<td>Validation error: <code>IllegalArgumentException</code></td>
</tr>
<tr>
<td>Applicant is over 25</td>
<td>Validation error: <code>IllegalArgumentException</code></td>
</tr>
<tr>
<td>Applicant has grade C, D, or E</td>
<td>Validation error: <code>IllegalArgumentException</code></td>
</tr>
<tr>
<td>Applicant missing required data</td>
<td>Conversion error: empty <code>Optional</code></td>
</tr>
<tr>
<td>Applicant missing optional data</td>
<td>An <code>Optional</code> containing <code>ApplicantAvro</code></td>
</tr>
</tbody>
</table>
<h3 id="successful-scenario">Successful scenario<a class="headerlink" href="#successful-scenario" title="Permanent link">&para;</a></h3>
<p>Testing the successful scenario <em>"should be"</em> straightforward:</p>
<ul>
<li>construct a <strong>valid</strong> object (age 18-25, grade A or B, and all required fields are not null)</li>
<li>pass it to the method under test</li>
<li>verify result has expected values</li>
</ul>
<p>However, if we want to be thorough, then we need to verify as many valid states as <em>reasonably</em> possible.
For example, is the range inclusive or exclusive?
Our range is inclusive, so we should have a test for an applicant aged 18, and another 25. We don't really need to verify the numbers in the middle.
This will ensure our service implemented the numeric bounds check correctly.
We should also test an applicant with grade A, and another with grade B.
Finally, we should verify that our service is not rejecting an applicant if optional data (such as <code>middleName</code>) is missing.</p>
<h3 id="application-validation">Application validation<a class="headerlink" href="#application-validation" title="Permanent link">&para;</a></h3>
<p>Testing <strong>validation</strong> errors also <em>"should not"</em> be too difficult:</p>
<ul>
<li>construct an <strong>invalid</strong> object</li>
<li>pass it to the method under test</li>
<li>verify the method throws the expected exception</li>
</ul>
<p>Here again we should cover as many bases as <em>reasonably</em> possible. This includes
applicants aged 17 and 26 and those with grades C, D, and F.</p>
<h3 id="schema-validation">Schema validation<a class="headerlink" href="#schema-validation" title="Permanent link">&para;</a></h3>
<p>Finally, we have schema validation implemented within auto-generated Avro classes.
For example, <code>firstName</code> is required in our <a href="https://github.com/instancio/instancio-samples/blob/main/instancio-models-sample/src/main/avro/applicant.avsc">schema</a>,
therefore passing <code>null</code> to <code>setFirstName()</code> will throw an <code>AvroRuntimeException</code> in which case our service should return an empty <code>Optional</code>.
We should have a test for that.
Ideally, we should verify this with <strong>every</strong> required field being <code>null</code>. Doing so has two benefits:</p>
<ol>
<li>it guarantees that we will not introduce unintended changes when modifying the schema in the future;</li>
<li>if we switch from Avro to another format, the test will ensure the same constraints are enforced in the new schema.</li>
</ol>
<p>However, most real world projects will rarely go this far due to time constraints or simply because it is too much effort.
We will look at how to implement such a test fairly easily using Instancio.</p>
<h2 id="writing-tests">Writing tests<a class="headerlink" href="#writing-tests" title="Permanent link">&para;</a></h2>
<h3 id="implementing-successful-scenario-tests">Implementing successful scenario tests<a class="headerlink" href="#implementing-successful-scenario-tests" title="Permanent link">&para;</a></h3>
<p>Let's start by testing a valid applicant. Typically, it will be implemented as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nd">@Test</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Valid applicant should be successfully converted to Avro&quot;</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">verifyValidApplicantAvro</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="c1">// Given</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createValidApplicant</span><span class="p">();</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="c1">// When</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">ApplicantAvro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toAvro</span><span class="p">(</span><span class="n">applicant</span><span class="p">);</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="c1">// Then</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="n">ApplicantAvro</span><span class="w"> </span><span class="n">applicantAvro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">applicantAvro</span><span class="p">.</span><span class="na">getFirstName</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getFirstName</span><span class="p">());</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">applicantAvro</span><span class="p">.</span><span class="na">getMiddleName</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getMiddleName</span><span class="p">());</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">applicantAvro</span><span class="p">.</span><span class="na">getLastName</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getLastName</span><span class="p">());</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">applicantAvro</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">isNotNull</span><span class="p">();</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applicant</span><span class="p">.</span><span class="na">getAddress</span><span class="p">();</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="n">AddressAvro</span><span class="w"> </span><span class="n">addressAvro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applicantAvro</span><span class="p">.</span><span class="na">getAddress</span><span class="p">();</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">addressAvro</span><span class="p">.</span><span class="na">getStreet</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getStreet</span><span class="p">());</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">addressAvro</span><span class="p">.</span><span class="na">getCity</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getCity</span><span class="p">());</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">addressAvro</span><span class="p">.</span><span class="na">getCountry</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getCountry</span><span class="p">());</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">addressAvro</span><span class="p">.</span><span class="na">getPostalCode</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getPostalCode</span><span class="p">());</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="p">}</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Applicant</span><span class="w"> </span><span class="nf">createValidApplicant</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">    </span><span class="n">Address</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="p">();</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">    </span><span class="n">address</span><span class="p">.</span><span class="na">setStreet</span><span class="p">(</span><span class="s">&quot;street&quot;</span><span class="p">);</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">    </span><span class="n">address</span><span class="p">.</span><span class="na">setCity</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">);</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">    </span><span class="n">address</span><span class="p">.</span><span class="na">setCountry</span><span class="p">(</span><span class="s">&quot;country&quot;</span><span class="p">);</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">    </span><span class="n">address</span><span class="p">.</span><span class="na">setPostalCode</span><span class="p">(</span><span class="s">&quot;postal-code&quot;</span><span class="p">);</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Applicant</span><span class="p">();</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">setFirstName</span><span class="p">(</span><span class="s">&quot;first-name&quot;</span><span class="p">);</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">setLastName</span><span class="p">(</span><span class="s">&quot;last-name&quot;</span><span class="p">);</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="hll"><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span>
</span><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="hll"><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">setGrade</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">A</span><span class="p">);</span>
</span><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">setAddress</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">applicant</span><span class="p">;</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="p">}</span>
</code></pre></div>
<p>We create a valid applicant and pass it to the method under test.
However, note the highlighted lines. The above test does not verify other successful scenarios we outlined earlier.
To do so, we can add parameters using JUnit 5 <code>@ParameterizedTest</code> to construct an applicant with different values.
The updated code is shown below. JUnit will automatically convert parameters to correct types, including the enum.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nd">@CsvSource</span><span class="p">({</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">        </span><span class="s">&quot;18, A&quot;</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="s">&quot;18, B&quot;</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="s">&quot;25, A&quot;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="s">&quot;25, B&quot;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="p">})</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="nd">@ParameterizedTest</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="kt">void</span><span class="w"> </span><span class="nf">verifyValidApplicantAvro</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="w"> </span><span class="n">grade</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="hll"><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createValidApplicant</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">grade</span><span class="p">);</span>
</span><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">ApplicantAvro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toAvro</span><span class="p">(</span><span class="n">applicant</span><span class="p">);</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="c1">// Remaining code is the same</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="p">}</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Applicant</span><span class="w"> </span><span class="nf">createValidApplicant</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="w"> </span><span class="n">grade</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Applicant</span><span class="p">();</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="n">age</span><span class="p">);</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">setGrade</span><span class="p">(</span><span class="n">grade</span><span class="p">);</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">    </span><span class="c1">// Remaining code is the same</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">applicant</span><span class="p">;</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="p">}</span>
</code></pre></div>
<p>Finally, we need to verify that the service does not reject an applicant if optional fields <code>middleName</code> and <code>postalCode</code> are <code>null</code>.
At this point, the test is already starting to get more complicated and forcing us to make decisions on how to proceed.
Possible options are:</p>
<ol>
<li>update the parameterized test to include <code>middleName</code> and <code>postalCode</code></li>
<li>do not populate optional fields in <code>createValidApplicant()</code></li>
<li>refactor <code>ParameterizedTest</code> to use <code>@MethodSource</code> instead of <code>@CsvSource</code></li>
<li>create a new test method</li>
</ol>
<p><strong>Option 1</strong> seems messy. Adding parameters makes the code harder to read and maintain. What if we need to add more optional parameters in the future?</p>
<div class="admonition quote">
<p class="admonition-title"><em>Clean Code</em>, Robert C. Martin</p>
<p>The ideal number of arguments for a function is zero (niladic). Next comes one (monadic), followed closely by two (dyadic). Three arguments (triadic) should be avoided where possible. More than three (polyadic) requires very special justification - and then shouldn’t be used anyway.</p>
</div>
<p><strong>Option 2</strong> is also not ideal. If the optional values are set to <code>null</code> then we are no longer testing those fields' mapping assertions.
Both, expected and actual, would always be <code>null</code> giving us a false sense of confidence.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">assertThat</span><span class="p">(</span><span class="n">applicantAvro</span><span class="p">.</span><span class="na">getMiddleName</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getMiddleName</span><span class="p">());</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">assertThat</span><span class="p">(</span><span class="n">addressAvro</span><span class="p">.</span><span class="na">getPostalCode</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">address</span><span class="p">.</span><span class="na">getPostalCode</span><span class="p">());</span>
</code></pre></div>
<p><strong>Option 3</strong> would be to modify the test method.
Maybe instead of passing individual arguments to the parameterized test, we pass an <code>Applicant</code> object as an argument.
This can be implemented using <code>@MethodSource</code> as the source of arguments.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="hll"><span class="nd">@MethodSource</span><span class="p">(</span><span class="s">&quot;validApplicants&quot;</span><span class="p">)</span>
</span><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nd">@ParameterizedTest</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="hll"><span class="kt">void</span><span class="w"> </span><span class="nf">verifyValidApplicantAvro</span><span class="p">(</span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">ApplicantAvro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toAvro</span><span class="p">(</span><span class="n">applicant</span><span class="p">);</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="c1">// Remaining code is the same</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="p">}</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="hll"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Arguments</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">validApplicants</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createValidApplicant</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">A</span><span class="p">);</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createValidApplicant</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">B</span><span class="p">);</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="c1">// Set optional fields to null</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createValidApplicant</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">B</span><span class="p">);</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="n">applicant3</span><span class="p">.</span><span class="na">setMiddleName</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="n">applicant3</span><span class="p">.</span><span class="na">getAddress</span><span class="p">().</span><span class="na">setPostalCode</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Stream</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">            </span><span class="n">Arguments</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">applicant1</span><span class="p">),</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">            </span><span class="n">Arguments</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">applicant2</span><span class="p">),</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">            </span><span class="n">Arguments</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">applicant3</span><span class="p">)</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">            </span><span class="c1">// etc...</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Option 4</strong> is to simply create a new test method as shown below.
Since we are adding a new test method,
we will need refactor the assertions into a separate <code>assertApplicant()</code> method to avoid duplicating them.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nd">@Test</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Applicant with missing optional data should not be rejected&quot;</span><span class="p">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">applicantWithMissingOptionalData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="c1">// Given</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createValidApplicant</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">A</span><span class="p">);</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">setMiddleName</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="n">applicant</span><span class="p">.</span><span class="na">getAddress</span><span class="p">().</span><span class="na">setPostalCode</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="c1">// When</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">ApplicantAvro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toAvro</span><span class="p">(</span><span class="n">applicant</span><span class="p">);</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="c1">// Then</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="na">isPresent</span><span class="p">();</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="n">assertApplicant</span><span class="p">(</span><span class="n">applicant</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="p">}</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">assertApplicant</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ApplicantAvro</span><span class="w"> </span><span class="n">applicantAvro</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">applicantAvro</span><span class="p">.</span><span class="na">getFirstName</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getFirstName</span><span class="p">());</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">applicantAvro</span><span class="p">.</span><span class="na">getMiddleName</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getMiddleName</span><span class="p">());</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">    </span><span class="c1">// Remaining assertions...</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="p">}</span>
</code></pre></div>
<h4 id="improving-the-test">Improving the test<a class="headerlink" href="#improving-the-test" title="Permanent link">&para;</a></h4>
<p>As we saw, test code can start to get more complicated and time-consuming very quickly even with our simple service.
Let's see how we can improve it. We are going to replace the data setup method by delegating object creation to Instancio.
An <code>Applicant</code> can be created simply as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">Applicant</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</code></pre></div>
<p>However, since we need a valid applicant with a certain age range and grades, we need to specify those parameters as well.
Below is our test and the updated <code>createValidApplicant()</code> method:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nd">@Test</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Valid applicant should be successfully converted to Avro&quot;</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">verifyValidApplicantAvro</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="hll"><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">createValidApplicant</span><span class="p">());</span>
</span><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="c1">// Remaining code is the same</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="p">}</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Applicant</span><span class="w"> </span><span class="nf">createValidApplicant</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">Applicant</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="na">ints</span><span class="p">().</span><span class="na">range</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">))</span>
</span><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="n">all</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">class</span><span class="p">),</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="na">oneOf</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">A</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">B</span><span class="p">))</span>
</span><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">            </span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="p">}</span>
</code></pre></div>
<p>Notice that we no longer need to use <code>@ParameterizedTest</code> or worry about populating a valid <code>Applicant</code> object in different states.
When the test runs, Instancio will generate an <code>Applicant</code> based on the specified parameters.
Since the object is randomly generated, our test will automatically cover different permutations of valid applicants.</p>
<p>We also need to verify that when optional fields are <code>null</code>, the method under test still works as expected.
By default, Instancio generates non-null values. Therefore, we need to specify which fields are nullable.
This can be done by tweaking <code>Applicant</code> creation as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Applicant</span><span class="w"> </span><span class="nf">createValidApplicant</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">Applicant</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">withNullable</span><span class="p">(</span><span class="n">all</span><span class="p">(</span>
</span><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="hll"><span class="w">                    </span><span class="n">field</span><span class="p">(</span><span class="s">&quot;middleName&quot;</span><span class="p">),</span>
</span><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="hll"><span class="w">                    </span><span class="n">field</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;postalCode&quot;</span><span class="p">)))</span>
</span><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">            </span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="na">ints</span><span class="p">().</span><span class="na">range</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">))</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">            </span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="n">all</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">class</span><span class="p">),</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="na">oneOf</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">A</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">B</span><span class="p">))</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">            </span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
</code></pre></div>
<p>The <code>withNullable()</code>  method will randomly generate <code>null</code> values for the specified fields.
The <code>all()</code> selector is a convenience method for grouping multiple selectors together.</p>
<p>Finally, JUnit 5 offers the <code>@RepeatedTest</code> annotation which can be used for executing a test multiple times.
We could use this annotation to ensure a greater number of data permutations our test is run against.
It might be unnecessary given the limited range of inputs in this simple example,
however, it is a good option to have at disposal when working with larger data sets.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="hll"><span class="nd">@RepeatedTest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">verifyValidApplicantAvro</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>This completes our "success scenario" test case. Next we will test the validation rules.</p>
<h3 id="implementing-application-validation-tests">Implementing application validation tests<a class="headerlink" href="#implementing-application-validation-tests" title="Permanent link">&para;</a></h3>
<p>As a reminder, the service throws an exception if an <code>Applicant</code> does not meet the the following requirements:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">ApplicantAvro</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">toAvro</span><span class="p">(</span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="n">Validate</span><span class="p">.</span><span class="na">isTrue</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">applicant</span><span class="p">.</span><span class="na">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">            </span><span class="s">&quot;Applicant must be between 18 and 25 years of age&quot;</span><span class="p">);</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="n">Validate</span><span class="p">.</span><span class="na">isTrue</span><span class="p">(</span><span class="n">applicant</span><span class="p">.</span><span class="na">getGrade</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">A</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">applicant</span><span class="p">.</span><span class="na">getGrade</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">B</span><span class="p">,</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">            </span><span class="s">&quot;Applicant&#39;s grade must be either A or B&quot;</span><span class="p">);</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">    </span><span class="c1">// ...snip...</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="p">}</span>
</code></pre></div>
<p>Just as before, this requires constructing <code>Applicant</code> objects in different states.
This time we will solve the problem using an Instancio <code>Model</code>.
A model can be thought of as a template for generating objects.
To create a model, the <code>createValidApplicant()</code> method can be modified as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span>
<span class="normal"><a href="#__codelineno-12-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="hll"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Model</span><span class="o">&lt;</span><span class="n">Applicant</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createValidApplicantModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">Applicant</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">            </span><span class="p">.</span><span class="na">withNullable</span><span class="p">(</span><span class="n">all</span><span class="p">(</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">                    </span><span class="n">field</span><span class="p">(</span><span class="s">&quot;middleName&quot;</span><span class="p">),</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">                    </span><span class="n">field</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;postalCode&quot;</span><span class="p">)))</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">            </span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="na">ints</span><span class="p">().</span><span class="na">range</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">))</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">            </span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="n">all</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">class</span><span class="p">),</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="na">oneOf</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">A</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">B</span><span class="p">))</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="hll"><span class="w">            </span><span class="p">.</span><span class="na">toModel</span><span class="p">();</span>
</span><a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The highlighted lines are the modifications.
First, the method signature now returns <code>Model&lt;Applicant&gt;</code> (and the method was renamed to <code>createValidApplicantModel()</code>).
The second change is instead of calling <code>create()</code>, which returns an <code>Applicant</code> instance, now we call <code>toModel()</code>.
We can now use this model instance as a template to generate <code>Applicant</code> instances as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">createValidApplicantModel</span><span class="p">());</span>
</code></pre></div>
<p>Using the valid applicant model, we can also construct <strong>invalid</strong> applicants by overriding certain parameters.
For example, age validation can be verified by using the valid applicant model and applying invalid age parameters as shown below.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nd">@Test</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Validation should fail if applicant is under 18 or over 25&quot;</span><span class="p">)</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">applicantAgeValidation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">createValidApplicantModel</span><span class="p">())</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">            </span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="na">oneOf</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">))</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">            </span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toAvro</span><span class="p">(</span><span class="n">applicant</span><span class="p">))</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">            </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">            </span><span class="p">.</span><span class="na">hasMessage</span><span class="p">(</span><span class="s">&quot;Applicant must be between 18 and 25 years of age&quot;</span><span class="p">);</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The single test above covers applicants below and above the required age range.
Grade validation can be tested in a similar manner by verifying grades C, D, and F.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nd">@Test</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Validation should fail if applicant&#39;s grade is lower than B&quot;</span><span class="p">)</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">applicantGradeValidation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">createValidApplicantModel</span><span class="p">())</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">            </span><span class="p">.</span><span class="na">generate</span><span class="p">(</span><span class="n">all</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">class</span><span class="p">),</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">gen</span><span class="p">.</span><span class="na">oneOf</span><span class="p">(</span><span class="n">Grade</span><span class="p">.</span><span class="na">C</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">D</span><span class="p">,</span><span class="w"> </span><span class="n">Grade</span><span class="p">.</span><span class="na">F</span><span class="p">))</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">            </span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toAvro</span><span class="p">(</span><span class="n">applicant</span><span class="p">))</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">            </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">            </span><span class="p">.</span><span class="na">hasMessage</span><span class="p">(</span><span class="s">&quot;Applicant&#39;s grade must be either A or B&quot;</span><span class="p">);</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="p">}</span>
</code></pre></div>
<h3 id="implementing-schema-validation-tests">Implementing schema validation tests<a class="headerlink" href="#implementing-schema-validation-tests" title="Permanent link">&para;</a></h3>
<p>The last test left to implement is to verify the schema.
We want to ensure that if any required field is set to <code>null</code>, the service returns an empty <code>Optional</code> as expected.
Essentially, we only want to test one required <code>null</code> field at a time.
In order to achieve this goal, we will again use our applicant <code>Model</code> as the starting point and then nullify a required field.
We will repeat this process for each required field, as shown in the following method.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="nd">@Test</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;Should return an empty Optional if any of the required fields is null&quot;</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">shouldReturnEmptyResultIfRequiredDataIsMissing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="n">Selector</span><span class="o">[]</span><span class="w"> </span><span class="n">requiredFields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">            </span><span class="n">field</span><span class="p">(</span><span class="n">Applicant</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;firstName&quot;</span><span class="p">),</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">            </span><span class="n">field</span><span class="p">(</span><span class="n">Applicant</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lastName&quot;</span><span class="p">),</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">            </span><span class="n">field</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;street&quot;</span><span class="p">),</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">            </span><span class="n">field</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;city&quot;</span><span class="p">),</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">            </span><span class="n">field</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;country&quot;</span><span class="p">)</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="c1">// Set each of these to null individually, so that only one required field is null at a time</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">    </span><span class="n">Arrays</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">requiredFields</span><span class="p">).</span><span class="na">forEach</span><span class="p">(</span><span class="n">requiredField</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">        </span><span class="c1">// Given</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">        </span><span class="n">Applicant</span><span class="w"> </span><span class="n">applicant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instancio</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">createValidApplicantModel</span><span class="p">())</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="hll"><span class="w">                </span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">requiredField</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
</span><a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="w">                </span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="w">        </span><span class="c1">// When</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">ApplicantAvro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">toAvro</span><span class="p">(</span><span class="n">applicant</span><span class="p">);</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="w">        </span><span class="c1">// Then</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">result</span><span class="p">).</span><span class="na">as</span><span class="p">(</span><span class="s">&quot;Expected %s to be required&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">requiredField</span><span class="p">).</span><span class="na">isNotPresent</span><span class="p">();</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Being able to select fields programmatically offers allows us to implement this type of test fairly easily.
Without library support, this type of testing would be tedious to implement.
It would require manually calling setters with a <code>null</code> value or implementing similar logic using reflection.
Neither of these options are practical.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>This concludes an overview of models. As we saw, writing tests can get tricky even when the class under test is fairly simple.
Populating objects can be time-consuming. In addition, constructing objects in different states for different test cases
presents its own challenges.</p>
<p>Using a data generator alleviates some of the above challenges.
The random nature of the data allows us to test a wider range of conditions.
This can reduce the number of test methods required to verify different outcomes.
Test methods themselves become simpler. For example, in a lot of cases we can eliminate the need for <code>@ParameterizedTest</code>.
In addition, the data setup code is more concise since we no longer need to manually populate objects.
The data setup code itself is easier to maintain and more flexible to change.</p>
<h2 id="source-code">Source code<a class="headerlink" href="#source-code" title="Permanent link">&para;</a></h2>
<p>Source code from this article is available as a Maven project from the
<a href="https://github.com/instancio/instancio-samples">instancio-samples</a> repository:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/instancio/instancio-samples.git
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nb">cd</span><span class="w"> </span>instancio-samples/instancio-models-sample
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>mvn<span class="w"> </span>package
</code></pre></div>



  



                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
<!-- More minimal footer -->

<footer class="md-footer">
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
            <!-- Copyright and theme information -->
            <div class="md-footer-copyright">
                
                <div class="md-footer-copyright__highlight">
                    &copy; Instancio 2022-2023
                </div>
                
                powered by
                <a href="https://www.mkdocs.org" title="MkDocs" target="_blank">MkDocs</a>
                and
                <a href="https://squidfunk.github.io/mkdocs-material/"
                   title="Material for MkDocs" target="_blank">
                    Material for MkDocs</a>
            </div>
            
            <div class="md-social">
  
</div>
            
        </div>
    </div>
</footer>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "toc.integrate"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ba449ae6.min.js"></script>
      
    
  </body>
</html>